<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Music Student MVP</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>ğŸµ App para Estudiantes de MÃºsica (MVP)</h1>

  <!-- Audio Upload -->
  <section>
    <label for="audioFile">Sube tu audio (MP3 o MP4):</label>
    <p class="hint">Selecciona la grabaciÃ³n de la pieza que vas a practicar.</p>
    <input type="file" id="audioFile" accept="audio/mp3,audio/mpeg,video/mp4" />
    <br />
    <audio id="audioPlayer" controls style="width: 100%; margin-top: 10px;"></audio>
    <br />
    <button id="markFirstNote" disabled>La primera nota entra aquÃ­</button>
    <p class="hint">Reproduce el audio y haz clic en este botÃ³n exactamente cuando suene la primera nota. Esto sincroniza la partitura con el audio.</p>
  </section>

  <!-- Score Upload -->
  <section>
    <label for="scoreFile">Sube tu partitura (PDF, JPG o PNG):</label>
    <p class="hint">Sube una foto, escaneo o PDF de tu partitura, tablatura o hoja de acordes.</p>
    <input type="file" id="scoreFile" accept=".pdf,.jpg,.jpeg,.png" />
    <div id="scoreContainer" style="margin-top: 10px; text-align: center; min-height: 400px;"></div>
  </section>

  <!-- Modo Profesor (Etapa 6) -->
  <section id="teacherModeSection">
    <h3>ğŸ‘¨â€ğŸ« Modo profesor</h3>
    <p class="hint">Configura BPM, offset y secciones para compartir con tus alumnos.</p>
    <label for="teacherBpm">BPM:</label>
    <input type="number" id="teacherBpm" min="20" max="300" placeholder="120" />
    
    <label for="teacherOffset">Offset (segundos):</label>
    <input type="number" id="teacherOffset" step="0.1" placeholder="0" />
    
    <label for="structureMarks">Marcas de estructura (opcional):</label>
    <p class="hint">Ej: "1:Intro,4:Verso,8:Estribillo" (compÃ¡s:nombre)</p>
    <input type="text" id="structureMarks" placeholder="1:Intro,4:Verso" style="width: 100%;" />
    
    <label>Rango de loop:</label>
    <div style="display: flex; gap: 10px;">
      <input type="number" id="teacherLoopFrom" min="1" placeholder="Desde" />
      <input type="number" id="teacherLoopTo" min="1" placeholder="Hasta" />
    </div>
    
    <button id="generateLink">Generar enlace para compartir</button>
    <p id="shareLink" style="word-break: break-all; margin-top: 10px; display: none;"></p>
  </section>

  <!-- Offset Display -->
  <section>
    <p id="offsetStatus">Desfase actual: 0s (ajustado automÃ¡ticamente o manual)</p>
    <label for="manualOffset">Ajuste manual (segundos):</label>
    <p class="hint">Si la partitura va adelantada o atrasada, ajusta aquÃ­ en pequeÃ±os pasos (ej. +0.2 o -0.3).</p>
    <input type="number" id="manualOffset" step="0.1" value="0" />
    <button id="applyManualOffset">Aplicar ajuste manual</button>
  </section>

  <!-- Etapa 2: SincronizaciÃ³n rÃ­tmica -->
  <section id="rhythmSection">
    <label for="bpmInput">BPM (beats per minute):</label>
    <p class="hint">Escribe el tempo de la pieza (ej. 120). La app usarÃ¡ esto para marcar los compases.</p>
    <input type="number" id="bpmInput" min="20" max="300" placeholder="Ej. 120" />
    <button id="startSync">Iniciar sincronizaciÃ³n rÃ­tmica</button>
    <button id="stopSync">Detener</button>
    <p id="measureInfo">DuraciÃ³n de compÃ¡s: -- segundos</p>
    <label>
      <input type="checkbox" id="followMode" checked />
      Modo â€œseguir siempreâ€ (no se detiene)
    </label>
    <p class="hint">Si activas esta opciÃ³n, el resaltado de compases seguirÃ¡ avanzando aunque te pierdas.</p>
  </section>

  <!-- Etapa 3: Controles en vivo + loop -->
  <section id="liveControlsSection">
    <h3>ğŸ›ï¸ Controles en vivo (ajuste fino)</h3>
    <p class="hint">Ajusta la sincronizaciÃ³n sobre la marcha mientras practicas.</p>
    <div class="live-controls-row">
      <button id="offsetMinus">â€“ 0.2s</button>
      <button id="offsetPlus">+ 0.2s</button>
    </div>
    <p>Offset aplicado: <span id="liveOffsetDisplay">0s</span></p>

    <h3>â­ï¸ Saltos por compases</h3>
    <p class="hint">Avanza o retrocede compases para repetir secciones difÃ­ciles.</p>
    <div class="live-controls-row">
      <button id="jumpBack2">â—„â—„ 2</button>
      <button id="jumpBack1">â—„ 1</button>
      <button id="jumpForward1">1 â–º</button>
      <button id="jumpForward2">2 â–ºâ–º</button>
    </div>

    <h3>ğŸ” Loop por secciÃ³n</h3>
    <p class="hint">Repite una secciÃ³n automÃ¡ticamente (ej. compases 5 a 8).</p>
    <label>
      Desde compÃ¡s:
      <input type="number" id="loopFrom" min="1" value="1" />
    </label>
    <label>
      Hasta compÃ¡s:
      <input type="number" id="loopTo" min="1" value="4" />
    </label>
    <br />
    <button id="setLoop">Establecer loop</button>
    <button id="clearLoop">Limpiar loop</button>
    <p id="loopStatus">Sin loop activo</p>
  </section>

  <!-- Etapa 4: Feedback visual rÃ­tmico -->
  <section id="visualFeedbackSection">
    <h3>ğŸ‘ï¸ Feedback visual rÃ­tmico</h3>
    <p class="hint">PrepÃ¡rate antes de tocar: verÃ¡s un pulso visual que marca el ritmo durante un compÃ¡s.</p>
    <button id="startCountdown">Iniciar cuenta atrÃ¡s (1 compÃ¡s)</button>
    <div id="pulseContainer">
      <div id="pulseCircle"></div>
    </div>
  </section>

  <!-- Etapa 5: Modos de visualizaciÃ³n -->
  <section id="viewModesSection">
    <h3>ğŸ‘ï¸ Modos de visualizaciÃ³n</h3>
    <p class="hint">Elige cÃ³mo quieres ver la prÃ¡ctica.</p>
    <button id="toggleFormMode">Modo â€œsolo formaâ€</button>
    <button id="toggleLookMode">Modo â€œsolo mirarâ€</button>
    <p id="modeStatus">Modo actual: Normal</p>
    <p class="hint">â€¢ <strong>Solo forma</strong>: oculta la partitura, Ãºtil para memorizar.  
       â€¢ <strong>Solo mirar</strong>: avanza sin audio, ideal para estudiar el ritmo antes de tocar.</p>
  </section>

  <!-- Marcas de estructura (Etapa 6) -->
  <div id="structureBar" style="display: none; position: fixed; top: 50px; left: 0; right: 0; background: #333; color: white; padding: 5px; text-align: center; z-index: 999;"></div>

  <!-- Indicador fijo de compÃ¡s actual -->
  <div id="currentMeasureIndicator" style="display: none;">
    CompÃ¡s actual: <span id="currentMeasureNumber">0</span>
  </div>

  <!-- Cargar PDF.js -->
  <script src="pdfjs/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs/pdf.worker.min.js';
  </script>
  <script src="script.js"></script>
</body>
</html>
